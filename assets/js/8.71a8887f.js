(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{195:function(e,t,a){"use strict";a.r(t);a(45),a(124);var r=a(125),i=a(131),s=a(132),n=a(136),o=a(171),l=a.n(o),c={name:"GiftSender",mixins:[i.a,s.a,n.a],data:function(){return{loading:!0,currentNetwork:null,price:1e-4,trxHash:"",trxLink:"",tokenLink:"",qrcode:"",makingTransaction:!1,gift:{beneficiary:"",content:{sender:"",receiver:"",message:""},date:"",style:0,value:"",privacyAndTerms:!1}}},computed:{encryptionKey:function(){return this.randomKey()},totalPrice:function(){var e=new this.web3.BigNumber(this.price),t=new this.web3.BigNumber(this.gift.value||0);return e.add(t).valueOf()}},mounted:function(){this.currentNetwork=this.getParam("network")||this.network.default,this.initDapp()},methods:{initDapp:function(){var e=Object(r.a)(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.network.current=this.network.list[this.currentNetwork],e.prev=1,e.next=4,this.initWeb3(this.currentNetwork,!0);case 4:this.initContracts(),this.loading=!1,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),alert(e.t0),document.location.href=this.$withBase("/");case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(){return e.apply(this,arguments)}}(),ready:function(){var e=this;this.$validator.extend("eth_address",{getMessage:function(e){return"Insert a valid Ethereum wallet address."},validate:function(t){return e.web3.isAddress(t)}})},createGift:function(){var e=this;this.metamask.installed?this.metamask.netId===this.network.current.id?this.$validator.validateAll().then(function(){var t=Object(r.a)(regeneratorRuntime.mark(function t(a){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!a){t.next=16;break}if(t.prev=1,e.trxHash="",e.trxLink="",e.tokenLink="",e.makingTransaction=!0,e.legacy){t.next=9;break}return t.next=9,e.web3Provider.enable();case 9:setTimeout(function(){var t=e.encrypt(JSON.stringify(e.gift.content),e.encryptionKey),a=e.gift.beneficiary||e.web3.eth.coinbase;e.instances.market.buyToken(a,t,new Date(e.gift.date).getTime()/1e3,e.gift.style,{value:e.web3.toWei(e.totalPrice,"ether"),from:e.web3.eth.coinbase},function(t,r){t?(e.makingTransaction=!1,alert("Some error occurred. Maybe you rejected the transaction or you have MetaMask locked!")):(e.trxHash=r,e.trxLink=e.network.current.etherscanLink+"/tx/"+e.trxHash,e.instances.market.TokenPurchase({purchaser:e.web3.eth.coinbase,beneficiary:a},function(t,a){t?(e.makingTransaction=!1,alert("Some error occurred. Maybe transaction failed for some reasons. Check your transaction id.")):(e.tokenLink=window.location.origin+e.$withBase("/view.html?id=".concat(a.args.tokenId.valueOf())),e.generateQRCode())}))})},500),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(1),e.makingTransaction=!1,alert("Some error occurred. Maybe you rejected the transaction or you have MetaMask locked!");case 16:case"end":return t.stop()}},t,this,[[1,12]])}));return function(e){return t.apply(this,arguments)}}()):alert("Your MetaMask in on the wrong network. Please switch on ".concat(this.network.current.name," and try again!")):alert("To create a Gift please install MetaMask!")},generateQRCode:function(){var e=this;this.tokenLink&&l.a.toDataURL(this.tokenLink).then(function(t){e.qrcode=t}).catch(function(e){console.error(e)})}}},d=a(4),v=Object(d.a)(c,function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.loading?e._e():a("div",[e.makingTransaction?[a("b-row",[a("b-col",{attrs:{lg:"8","offset-lg":"2"}},[e.tokenLink?a("b-card",{staticClass:"shadow-lg mb-3",attrs:{"img-src":e.$withBase("assets/images/cryptogift-og.jpg"),title:"Your CryptoGift is on the Blockchain","bg-variant":"light"}},[a("p",{staticClass:"card-text"},[a("a",{attrs:{target:"_blank",href:e.tokenLink}},[e._v(e._s(e.tokenLink))])]),e._v(" "),a("b-row",[a("b-col",{staticClass:"mb-2",attrs:{md:"9"}},[a("p",{staticClass:"card-text"},[e._v("\n                                Visit the link above or scan the QR Code and then enter your encryption key "),a("b",[e._v(e._s(e.encryptionKey))]),e._v("."),a("br"),e._v("\n                                Find out who sent it to you and what he wants to say."),a("br"),e._v("\n                                View your unique Gift on the Blockchain!\n                            ")]),e._v(" "),a("b-button",{staticClass:"d-print-none",attrs:{size:"lg",variant:"outline-success"},on:{click:e.print}},[e._v("Print your Gift")])],1),e._v(" "),a("b-col",{staticClass:"mb-2",attrs:{md:"3"}},[e.qrcode?a("b-img",{attrs:{src:e.qrcode,"fluid-grow":""}}):e._e()],1)],1)],1):e._e(),e._v(" "),a("b-alert",{staticClass:"d-print-none",attrs:{show:"",variant:"warning"}},[a("h6",[e._v("Your encryption key is "),a("b",[e._v(e._s(e.encryptionKey))])]),e._v(" "),a("b",[e._v("Do not lose it!")]),e._v(" It cannot be recovered if you lose it. It allows receiver to decrypt your message. You "),a("b",[e._v("must")]),e._v(" copy and share it with receiver.\n                ")]),e._v(" "),e.trxHash?a("b-alert",{staticClass:"d-print-none",attrs:{show:"",variant:"success"}},[a("div",{staticClass:"text-truncate"},[a("b",[e._v("Well! Transaction done!")]),a("br"),e._v("\n                        TxHash "),a("a",{attrs:{href:e.trxLink,target:"_blank"}},[e._v(e._s(e.trxHash))])]),e._v(" "),e.tokenLink?e._e():a("div",[e._v("\n                        Retrieving Gift. Please wait...\n                    ")])]):a("b-alert",{attrs:{show:"",variant:"light"}},[e._v("Making transaction. Do not refresh the page. Please wait...")])],1)],1)]:[a("b-form",{on:{submit:function(t){return t.preventDefault(),e.createGift(t)}}},[a("fieldset",{attrs:{disabled:!e.metamask.installed}},[a("b-row",[a("b-col",{staticClass:"mb-4",attrs:{lg:"7"}},[a("b-card",{staticClass:"shadow-lg",attrs:{"bg-variant":"light"}},[a("b-form-group",{attrs:{id:"gift-sender-group",label:"Sender Name:","label-for":"gift-sender",description:"The name of your gift sender"}},[a("b-form-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],class:{"is-invalid":e.errors.has("gift-sender")},attrs:{id:"gift-sender",name:"gift-sender",type:"text","data-vv-as":"Sender",placeholder:"Enter sender name"},model:{value:e.gift.content.sender,callback:function(t){e.$set(e.gift.content,"sender",t)},expression:"gift.content.sender"}}),e._v(" "),a("small",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("gift-sender"),expression:"errors.has('gift-sender')"}],staticClass:"text-danger"},[e._v("\n                                    "+e._s(e.errors.first("gift-sender"))+"\n                                ")])],1),e._v(" "),a("b-form-group",{attrs:{id:"gift-receiver-group",label:"Receiver Name:","label-for":"gift-receiver",description:"The name of your gift receiver"}},[a("b-form-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],class:{"is-invalid":e.errors.has("gift-receiver")},attrs:{id:"gift-receiver",name:"gift-receiver",type:"text","data-vv-as":"Receiver",placeholder:"Enter receiver name"},model:{value:e.gift.content.receiver,callback:function(t){e.$set(e.gift.content,"receiver",t)},expression:"gift.content.receiver"}}),e._v(" "),a("small",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("gift-receiver"),expression:"errors.has('gift-receiver')"}],staticClass:"text-danger"},[e._v("\n                                    "+e._s(e.errors.first("gift-receiver"))+"\n                                ")])],1),e._v(" "),a("b-form-group",{attrs:{id:"gift-date-group",label:"Date:","label-for":"gift-date",description:"The date of your gift"}},[a("b-form-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],class:{"is-invalid":e.errors.has("gift-date")},attrs:{id:"gift-date",name:"gift-date",type:"datetime-local","data-vv-as":"Date"},model:{value:e.gift.date,callback:function(t){e.$set(e.gift,"date",t)},expression:"gift.date"}}),e._v(" "),a("small",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("gift-date"),expression:"errors.has('gift-date')"}],staticClass:"text-danger"},[e._v("\n                                    "+e._s(e.errors.first("gift-date"))+"\n                                ")])],1),e._v(" "),a("b-form-group",{attrs:{id:"gift-message-group",label:"Message:","label-for":"gift-message",description:"The message you want to send"}},[a("b-form-textarea",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],class:{"is-invalid":e.errors.has("gift-message")},attrs:{id:"gift-message",name:"gift-message","data-vv-as":"Message",placeholder:"Enter your message",rows:4,"no-resize":!0},model:{value:e.gift.content.message,callback:function(t){e.$set(e.gift.content,"message",t)},expression:"gift.content.message"}}),e._v(" "),a("small",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("gift-message"),expression:"errors.has('gift-message')"}],staticClass:"text-danger"},[e._v("\n                                    "+e._s(e.errors.first("gift-message"))+"\n                                ")])],1),e._v(" "),a("b-form-group",[a("div",{staticClass:"form-check"},[a("input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"},{name:"model",rawName:"v-model",value:e.gift.privacyAndTerms,expression:"gift.privacyAndTerms"}],staticClass:"form-check-input",class:{"is-invalid":e.errors.has("gift-privacy-and-terms")},attrs:{type:"checkbox",id:"gift-privacy-and-terms",name:"gift-privacy-and-terms",value:"1"},domProps:{checked:Array.isArray(e.gift.privacyAndTerms)?e._i(e.gift.privacyAndTerms,"1")>-1:e.gift.privacyAndTerms},on:{change:function(t){var a=e.gift.privacyAndTerms,r=t.target,i=!!r.checked;if(Array.isArray(a)){var s=e._i(a,"1");r.checked?s<0&&e.$set(e.gift,"privacyAndTerms",a.concat(["1"])):s>-1&&e.$set(e.gift,"privacyAndTerms",a.slice(0,s).concat(a.slice(s+1)))}else e.$set(e.gift,"privacyAndTerms",i)}}}),e._v(" "),a("label",{staticClass:"form-check-label",attrs:{for:"gift-privacy-and-terms"}},[e._v("\n                                        I accept the terms and use\n                                    ")])])])],1)],1),e._v(" "),a("b-col",{staticClass:"mb-4",attrs:{lg:"5"}},[a("b-card",{staticClass:"shadow-lg",attrs:{"bg-variant":"light"}},[e.metamask.installed?e.metamask.netId!==e.network.current.id?a("b-alert",{attrs:{show:"",variant:"warning"}},[e._v("\n                                You are on the wrong Network."),a("br"),e._v("Please switch your MetaMask on "),a("b",[e._v(e._s(e.network.current.name))]),e._v(".\n                            ")]):e._e():a("b-alert",{attrs:{show:"",variant:"warning"}},[e._v("\n                                You need "),a("a",{attrs:{href:"https://metamask.io/",target:"_blank"}},[e._v("MetaMask")]),e._v(" extension.\n                            ")]),e._v(" "),a("b-form-group",{attrs:{id:"gift-beneficiary-group",label:"Receiver Ethereum Address:","label-for":"gift-beneficiary",description:"The Ethereum address of your receiver"}},[a("b-form-input",{directives:[{name:"validate",rawName:"v-validate",value:"required|eth_address",expression:"'required|eth_address'"}],class:{"is-invalid":e.errors.has("gift-beneficiary")},attrs:{id:"gift-beneficiary",name:"gift-beneficiary",type:"text","data-vv-as":"Wallet Address",placeholder:"0x12312312..."},model:{value:e.gift.beneficiary,callback:function(t){e.$set(e.gift,"beneficiary",t)},expression:"gift.beneficiary"}}),e._v(" "),a("small",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("gift-beneficiary"),expression:"errors.has('gift-beneficiary')"}],staticClass:"text-danger"},[e._v("\n                                    "+e._s(e.errors.first("gift-beneficiary"))+"\n                                ")])],1),e._v(" "),a("b-form-group",{attrs:{id:"gift-value-group",label:"Gift Value:","label-for":"gift-value",description:"The value of your gift"}},[a("b-form-input",{directives:[{name:"validate",rawName:"v-validate",value:{required:!0,decimal:4},expression:"{ required: true, decimal: 4 }"}],class:{"is-invalid":e.errors.has("gift-value")},attrs:{id:"gift-value",name:"gift-value",step:"0.1",type:"number",min:"0","data-vv-as":"Value",placeholder:"Enter gift value"},model:{value:e.gift.value,callback:function(t){e.$set(e.gift,"value",t)},expression:"gift.value"}}),e._v(" "),a("small",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("gift-value"),expression:"errors.has('gift-value')"}],staticClass:"text-danger"},[e._v("\n                                    "+e._s(e.errors.first("gift-value"))+"\n                                ")])],1),e._v(" "),a("b-form-group",{attrs:{id:"gift-style-group",label:"Style:","label-for":"gift-style",description:"The style of your gift"}},[a("b-form-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],class:{"is-invalid":e.errors.has("gift-style")},attrs:{id:"gift-style",name:"gift-style","data-vv-as":"Style"},model:{value:e.gift.style,callback:function(t){e.$set(e.gift,"style",t)},expression:"gift.style"}},[a("option",{attrs:{value:"0"}},[e._v("default ("+e._s(e.price)+" ETH)")])]),e._v(" "),a("small",{directives:[{name:"show",rawName:"v-show",value:e.errors.has("gift-style"),expression:"errors.has('gift-style')"}],staticClass:"text-danger"},[e._v("\n                                    "+e._s(e.errors.first("gift-style"))+"\n                                ")])],1),e._v(" "),a("b-list-group",{staticClass:"mb-4"},[a("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center",attrs:{variant:"light"}},[e._v("\n                                    Gift Value "),a("b-badge",{attrs:{variant:"light",pill:""}},[e._v(e._s(e.gift.value||0)+" ETH")])],1),e._v(" "),a("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center",attrs:{variant:"light"}},[e._v("\n                                    Gift Cost "),a("b-badge",{attrs:{variant:"light",pill:""}},[e._v(e._s(e.price)+" ETH")])],1),e._v(" "),a("b-list-group-item",{staticClass:"d-flex justify-content-between align-items-center"},[e._v("\n                                    Total "),a("b-badge",{attrs:{variant:"light",pill:""}},[e._v(e._s(e.totalPrice)+" ETH")])],1)],1),e._v(" "),a("b-button",{attrs:{type:"submit",variant:"outline-success",size:"lg"}},[e._v("Send your Gift")])],1)],1)],1)],1)])]],2)},[],!1,null,null,null);v.options.__file="GiftSender.vue";t.default=v.exports}}]);